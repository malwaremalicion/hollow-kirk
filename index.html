<!DOCTYPE html>
<html>
<head>
<title>Chirk Knight</title>
<style>
    body { margin:0; overflow:hidden; background:black; font-family:sans-serif; }
    canvas { background:black; display:block; }

    #ui, #pauseMenu, #deathMenu, #mainMenu, #mapScreen {
        position:absolute; left:0; top:0; width:100%; height:100%;
        display:flex; justify-content:center; align-items:center;
        flex-direction:column; color:white; font-size:32px;
        background:rgba(0,0,0,0.6); z-index:10; 
    }

    button {
        padding:15px 30px; margin:10px;
        background:#222; border:2px solid white; color:white;
        font-size:22px; cursor:pointer;
    }

    #ui { z-index:5; pointer-events:none; background:none; }
</style>
</head>
<body>

<canvas id="game" width="1280" height="720"></canvas>

<!-- UI -->
<div id="ui">
    <div id="hpDisplay">HP: 4</div>
</div>

<!-- MAIN MENU -->
<div id="mainMenu">
    <h1>Chirk Knight</h1>
    <button onclick="startGame()">Start</button>
</div>

<!-- PAUSE MENU -->
<div id="pauseMenu" style="display:none;">
    <h1>Paused</h1>
    <button onclick="resumeGame()">Resume</button>
    <button onclick="openMap()">Map</button>
    <button onclick="location.reload()">Quit</button>
</div>

<!-- MAP SCREEN -->
<div id="mapScreen" style="display:none;">
    <h1>MAP</h1>
    <p>Massive level overview (concept)</p>
    <button onclick="closeMap()">Close</button>
</div>

<!-- DEATH MENU -->
<div id="deathMenu" style="display:none;">
    <h1>You Died</h1>
    <button onclick="location.reload()">Return to Menu</button>
</div>

<script>
// -----------------------------------------------
// ASSETS
// -----------------------------------------------
let imgPlayer = new Image(); imgPlayer.src = "chirk.png";
let imgAttack = new Image(); imgAttack.src = "chirka.png";
let imgEnemy = new Image(); imgEnemy.src = "cheese.png";
let imgBoss = new Image(); imgBoss.src = "supercheese.png";
let imgGround = new Image(); imgGround.src = "g.png";
let imgSpike = new Image(); imgSpike.src = "stug.png";
let imgBall = new Image(); imgBall.src = "BALL.png";
let imgBg = new Image(); imgBg.src = "bg.png";

// AUDIO
let sfxStep = new Audio("step.mp3");
let sfxEnemyDie = new Audio("owe.mp3");
let sfxPlayerDie = new Audio("ow.mp3");

let bgm = new Audio("bgm.mp3"); bgm.loop = true;
let bossMusic = new Audio("boss.mp3"); bossMusic.loop = true;

// -----------------------------------------------
// GAME VARIABLES
// -----------------------------------------------
const cvs = document.getElementById("game");
const ctx = cvs.getContext("2d");

let keys = {};
let gameRunning = false;
let paused = false;

let gravity = 1.1;
let cameraX = 0;
let cameraY = 0;

let player = {
    x: 100, y: 500, w: 60, h: 60,
    vx: 0, vy: 0,
    speed: 6,
    jumping: false,
    hp: 4,
    attacking: false,
    attackTimer: 0
};

// MASSIVE LEVEL
let platforms = [];
for (let i = 0; i < 30; i++) {
    platforms.push({ x: i*300, y: 600, w: 300, h:50 });
    if (i % 3 === 0)
        platforms.push({ x: i*300, y: 450, w: 300, h:50 });
}

// SPIKES
let spikes = [
    {x: 1200, y: 580, w:50, h:50},
    {x: 1800, y: 580, w:50, h:50}
];

// ENEMIES
function createEnemy(x,y){
    return {
        x, y, w:60, h:60,
        hp:2,
        shootTimer:0,
        dealDamageCooldown:0
    };
}

let enemies = [
    createEnemy(800,540),
    createEnemy(1400,540),
    createEnemy(2000,540)
];

// PROJECTILES
let balls = [];

// BOSS
let boss = {
    active:false,
    x: 3500, y: 520,
    w:150, h:150,
    hp:20,
    fightStarted:false,
    inFrame:false
};

// -----------------------------------------------
// INPUT
// -----------------------------------------------
document.addEventListener("keydown", e=>{
    keys[e.key] = true;
    if (e.key === "Escape" && gameRunning) togglePause();
});
document.addEventListener("keyup", e=> keys[e.key] = false);

// -----------------------------------------------
// MENUS
// -----------------------------------------------
function startGame(){
    document.getElementById("mainMenu").style.display="none";
    gameRunning = true;
    bgm.play();
    loop();
}

function togglePause(){
    paused = !paused;
    document.getElementById("pauseMenu").style.display = paused ? "flex" : "none";
}

function resumeGame(){
    paused=false;
    document.getElementById("pauseMenu").style.display="none";
}

function openMap(){
    document.getElementById("mapScreen").style.display="flex";
}
function closeMap(){
    document.getElementById("mapScreen").style.display="none";
}

// -----------------------------------------------
// COLLISION
// -----------------------------------------------
function rectColl(a,b){
    return a.x < b.x+b.w && a.x+a.w > b.x &&
           a.y < b.y+b.h && a.y+a.h > b.y;
}

// -----------------------------------------------
// UPDATE
// -----------------------------------------------
function update(){

    if (paused) return;

    // gravity
    player.vy += gravity;
    player.y += player.vy;

    // horizontal
    if (keys["ArrowLeft"]) player.vx = -player.speed;
    else if (keys["ArrowRight"]) player.vx = player.speed;
    else player.vx = 0;

    player.x += player.vx;

    // jump
    if (keys["ArrowUp"] && !player.jumping){
        player.vy = -20;
        player.jumping = true;
    }

    // ATTACK
    if (keys["z"] && !player.attacking){
        player.attacking = true;
        player.attackTimer = 10;
    }

    if (player.attacking){
        player.attackTimer--;
        if (player.attackTimer<=0) player.attacking=false;
    }

    // PLATFORM COLLISION
    for (let p of platforms){
        if (rectColl(player,p)){
            if (player.vy > 0){
                player.y = p.y - player.h;
                player.vy = 0;
                player.jumping = false;
            }
        }
    }

    // SPIKE DAMAGE
    for (let s of spikes){
        if (rectColl(player,s)){
            damagePlayer();
        }
    }

    // ENEMY BEHAVIOR
    for (let e of enemies){
        if (e.hp<=0) continue;

        // Shoot toward player
        e.shootTimer++;
        if (e.shootTimer > 120){
            let dx = (player.x - e.x);
            let dy = (player.y - e.y);
            let len = Math.sqrt(dx*dx + dy*dy);
            dx/=len; dy/=len;

            balls.push({x:e.x, y:e.y, vx:dx*6, vy:dy*6, w:20, h:20});
            e.shootTimer=0;
        }

        // damage player on touch
        if (rectColl(player,e)){
            damagePlayer();
        }
    }

    // boss activation when on screen
    boss.inFrame = boss.x - cameraX < cvs.width && boss.x - cameraX > -boss.w;

    if (boss.inFrame && !boss.fightStarted){
        boss.fightStarted = true;
        bgm.pause();
        bossMusic.play();
        enemies = []; // despawn all normal enemies
    }

    if (boss.fightStarted){
        if (boss.hp>0){
            // boss shoots faster
            if (!boss.shootTimer) boss.shootTimer = 0;
            boss.shootTimer++;
            if (boss.shootTimer > 60){
                let dx = (player.x - boss.x);
                let dy = (player.y - boss.y);
                let len = Math.sqrt(dx*dx+dy*dy);
                dx/=len; dy/=len;
                balls.push({x:boss.x,y:boss.y,vx:dx*8,vy:dy*8,w:30,h:30});
                boss.shootTimer=0;
            }

            // lock camera
            cameraX = boss.x - (cvs.width/2);
        } else {
            // respawn enemies after boss dies
            if (enemies.length===0){
                enemies = [
                    createEnemy(800,540),
                    createEnemy(1400,540),
                    createEnemy(2000,540)
                ];
            }
        }
    }

    // PROJECTILE UPDATE
    for (let b of balls){
        b.x += b.vx;
        b.y += b.vy;
        if (rectColl(player,b)) damagePlayer();
    }

    // CAMERA FOLLOW (disabled during boss)
    if (!boss.fightStarted){
        cameraX = player.x - cvs.width/2;
        if (cameraX < 0) cameraX=0;
    }

    document.getElementById("hpDisplay").innerText = "HP: " + player.hp;
}

function damagePlayer(){
    player.hp--;
    sfxPlayerDie.play();
    if (player.hp <=0){
        gameRunning=false;
        document.getElementById("deathMenu").style.display="flex";
    }
}

// -----------------------------------------------
// RENDER
// -----------------------------------------------
function draw(){
    ctx.clearRect(0,0,cvs.width,cvs.height);

    ctx.drawImage(imgBg, -cameraX*0.2, 0, 4000, 720);

    // platforms
    for (let p of platforms)
        ctx.drawImage(imgGround, p.x-cameraX, p.y, p.w, p.h);

    // spikes
    for (let s of spikes)
        ctx.drawImage(imgSpike, s.x-cameraX, s.y, s.w, s.h);

    // enemies
    for (let e of enemies){
        if (e.hp>0)
            ctx.drawImage(imgEnemy, e.x-cameraX, e.y, e.w, e.h);
    }

    // balls
    for (let b of balls){
        ctx.drawImage(imgBall, b.x-cameraX, b.y, b.w, b.h);
    }

    // boss
    if (!boss.fightStarted || boss.hp>0)
        ctx.drawImage(imgBoss, boss.x-cameraX, boss.y, boss.w, boss.h);

    // ATTACK
    if (player.attacking){
        ctx.drawImage(imgAttack, player.x-cameraX + (player.vx>=0?60:-60), player.y, 60,60);
    }

    // PLAYER
    ctx.drawImage(imgPlayer, player.x-cameraX, player.y, player.w, player.h);
}

// -----------------------------------------------
// LOOP
// -----------------------------------------------
function loop(){
    if (!gameRunning) return;
    update();
    draw();
    requestAnimationFrame(loop);
}
</script>

</body>
</html>





